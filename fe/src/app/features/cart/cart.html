<div class="container my-5">
  <h2 class="fw-bold mb-4">Giỏ hàng</h2>
  <p class="text-muted mb-4" *ngIf="cartService.cartItems().length > 0">
    Bạn có {{ cartService.cartItems().length }} sản phẩm trong giỏ hàng.
  </p>

  <div *ngIf="cartService.cartItems().length === 0" class="text-center py-5 bg-light rounded-3">
    <i class="bi bi-cart-x display-1 text-muted"></i>
    <h4 class="mt-3">Giỏ hàng của bạn đang trống</h4>
    <a routerLink="/" class="btn btn-primary mt-3">Tiếp tục mua sắm</a>
  </div>

  <div class="row" *ngIf="cartService.cartItems().length > 0">

    <div class="col-lg-8">
      <div class="card border shadow-sm mb-4">
        <div class="card-body p-0">

          <div class="d-none d-md-flex p-3 border-bottom bg-light fw-bold text-muted small">
            <div class="col-md-5 ps-4">SẢN PHẨM</div>
            <div class="col-md-2 text-center">ĐƠN GIÁ</div>
            <div class="col-md-2 text-center">SỐ LƯỢNG</div>
            <div class="col-md-2 text-end pe-4">SỐ TIỀN</div>
            <div class="col-md-1"></div>
          </div>

          <div *ngFor="let item of cartService.cartItems()" class="p-3 border-bottom cart-item-row">
            <div class="row align-items-center">

              <div class="col-md-5 d-flex align-items-center gap-3 overflow-hidden">
                <input type="checkbox" class="form-check-input mt-0" checked>
                <img [src]="item.product.imageUrl || 'https://via.placeholder.com/80'" class="rounded bg-light"
                  style="width: 80px; height: 80px; object-fit: cover;">
                <div>

                  <div class="product-info">
                    <h6 class="mb-1 product-name" [title]="item.product.name">
                      <a [routerLink]="['/product', item.product.id]" class="text-dark text-decoration-none">
                        {{ item.product.name }}
                      </a>
                    </h6>
                    <div class="small text-muted">
                      {{ item.product.shopName || 'Shop' }}
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-2 text-center fw-bold text-secondary d-none d-md-block">
                {{ item.product.price | currency:'VND':'symbol':'1.0-0' }}
              </div>

              <div class="col-md-2 d-flex justify-content-center">
                <div class="input-group input-group-sm" style="width: 100px;">
                  <button class="btn btn-outline-secondary"
                    (click)="decreaseQty(item.product.id, item.quantity)">-</button>
                  <input type="text" class="form-control text-center bg-white" [value]="item.quantity" readonly>
                  <button class="btn btn-outline-secondary"
                    (click)="increaseQty(item.product.id, item.quantity)">+</button>
                </div>
              </div>

              <div class="col-md-2 text-end fw-bold d-none d-md-block">
                {{ item.product.price * item.quantity | currency:'VND':'symbol':'1.0-0' }}
              </div>

              <div class="col-md-1 text-end">
                <button class="btn btn-link text-danger p-0" (click)="removeItem(item.product.id)">
                  <i class="bi bi-trash fs-5"></i>
                </button>
              </div>

            </div>
          </div>

        </div>
      </div>

      <a routerLink="/" class="text-decoration-none text-primary fw-bold">
        <i class="bi bi-arrow-left"></i> Tiếp tục mua sắm
      </a>

      <div class="mt-5">
        <h5 class="fw-bold mb-3">Có thể bạn cũng thích</h5>
        <div class="row row-cols-2 row-cols-md-4 g-3">
          <div class="col">
            <div class="card h-100 border-0 shadow-sm">
              <img src="https://via.placeholder.com/150" class="card-img-top p-3 rounded">
              <div class="card-body pt-0">
                <p class="card-text small fw-bold">Chuột không dây Pro</p>
                <p class="text-muted small">$49.99</p>
                <button class="btn btn-outline-primary btn-sm w-100">Thêm vào giỏ</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="col-lg-4">
      <div class="card border shadow-sm">
        <div class="card-body p-4">
          <h5 class="card-title fw-bold mb-4">Tóm tắt đơn hàng</h5>

          <div class="d-flex justify-content-between mb-2 text-muted">
            <span>Tạm tính ({{ cartService.totalCount() }} sản phẩm)</span>
            <span>{{ cartService.subTotal() | currency:'VND':'symbol':'1.0-0' }}</span>
          </div>

          <div class="d-flex justify-content-between mb-2 text-muted">
            <span>Phí vận chuyển</span>
            <span class="text-success">Miễn phí</span>
          </div>

          <div class="d-flex justify-content-between mb-2 text-muted">
            <span>Thuế ước tính</span>
            <span>{{ taxEstimate | currency:'VND':'symbol':'1.0-0' }}</span>
          </div>

          <div class="d-flex justify-content-between mb-4 text-danger">
            <span>Giảm giá</span>
            <span>-{{ discount | currency:'VND':'symbol':'1.0-0' }}</span>
          </div>

          <hr>

          <div class="d-flex justify-content-between align-items-center mb-4">
            <span class="fw-bold fs-5">Tổng cộng</span>
            <span class="fw-bold fs-4">{{ finalTotal | currency:'VND':'symbol':'1.0-0' }}</span>
          </div>

          <div class="input-group mb-4">
            <input type="text" class="form-control" placeholder="Mã giảm giá">
            <button class="btn btn-light border">Áp dụng</button>
          </div>

          <button class="btn btn-orange w-100 py-3 fw-bold text-white mb-3 shadow-sm" routerLink="/checkout"> Tiến hành
            thanh toán <i class="bi bi-arrow-right ms-2"></i>
          </button>

          <div class="text-center small text-muted">
            <div class="d-flex justify-content-center gap-3 mb-2 fs-5 text-secondary">
              <i class="bi bi-lock-fill"></i>
              <i class="bi bi-shield-check"></i>
              <i class="bi bi-truck"></i>
            </div>
            Thanh toán an toàn • Đổi trả trong 30 ngày
          </div>

        </div>
      </div>
    </div>

  </div>
</div>