<div *ngIf="isLoading" class="d-flex justify-content-center align-items-center vh-100 bg-white">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<div *ngIf="!isLoading" class="d-flex w-100 min-vh-100 bg-light font-family-sans">

  <ng-container *ngIf="status === 'ACTIVE'">
    
    <aside class="sidebar bg-white border-end d-flex flex-column" 
           [class.closed]="!sidebarOpen">
      
      <div class="p-4 d-flex align-items-center gap-2 border-bottom border-light">
        <div class="bg-primary rounded-3 d-flex align-items-center justify-content-center text-white flex-shrink-0" style="width: 32px; height: 32px;">
          <img [src]="shop?.logoUrl" onerror="this.style.display='none'" class="w-100 h-100 rounded-3 object-fit-cover">
          <i class="bi bi-shop" *ngIf="!shop?.logoUrl"></i>
        </div>
        <div class="overflow-hidden">
          <h5 class="fw-bold mb-0 text-primary text-truncate">{{ shop?.shopName || 'MerchantHub' }}</h5>
        </div>
      </div>

      <div class="px-3 py-2 flex-grow-1 overflow-y-auto custom-scrollbar">
        
        <small class="text-muted fw-bold text-uppercase px-3 mt-3 d-block" style="font-size: 11px;">Bảng điều khiển</small>
        <ul class="nav flex-column mt-2 gap-1">
          <li class="nav-item" *ngFor="let item of mainMenuItems">
            <a [routerLink]="item.route" 
               routerLinkActive="active" 
               class="nav-link d-flex align-items-center gap-3 rounded-3 px-3 py-2">
              <i [class]="item.icon"></i> 
              <span class="nav-label">{{ item.label }}</span>
              <span *ngIf="item.badge" class="badge bg-primary bg-opacity-10 text-primary ms-auto rounded-pill nav-label">
                {{ item.badge }}
              </span>
            </a>
          </li>
        </ul>

        <small class="text-muted fw-bold text-uppercase px-3 mt-4 d-block" style="font-size: 11px;">Cài đặt</small>
        <ul class="nav flex-column mt-2 gap-1">
          <li class="nav-item" *ngFor="let item of settingsMenuItems">
            <a [routerLink]="item.route" 
               routerLinkActive="active" 
               class="nav-link d-flex align-items-center gap-3 rounded-3 px-3 py-2">
              <i [class]="item.icon"></i> 
              <span class="nav-label">{{ item.label }}</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="p-3 mt-auto border-top border-light">
        <div class="bg-light rounded-3 p-3 d-flex align-items-center gap-3 user-card">
          <img [src]="shop?.ownerAvatar || 'https://ui-avatars.com/api/?name=' + shop?.shopName" 
               class="rounded-circle border" width="40" height="40" alt="Avatar">
          <div class="overflow-hidden nav-label">
            <div class="fw-bold text-truncate text-dark" style="font-size: 14px;">{{ shop?.shopName }}</div>
            <div class="text-muted small text-truncate">Chủ cửa hàng</div>
          </div>
          <button class="btn btn-sm text-secondary ms-auto hover-danger" (click)="logout()" title="Đăng xuất">
            <i class="bi bi-box-arrow-right"></i>
          </button>
        </div>
      </div>
    </aside>

    <main class="flex-grow-1 d-flex flex-column h-100 overflow-hidden wrapper">
      
      <header class="bg-white border-bottom py-3 px-4 d-flex justify-content-between align-items-center sticky-top z-1">
        
        <div class="d-flex align-items-center gap-3">
          <button class="btn btn-light border d-lg-none" (click)="toggleSidebar()">
            <i class="bi bi-list"></i>
          </button>
          
          <div class="input-group bg-light rounded-pill border-0 d-none d-md-flex" style="width: 300px;">
             <span class="input-group-text bg-transparent border-0 ps-3"><i class="bi bi-search text-muted"></i></span>
             <input type="text" class="form-control bg-transparent border-0 shadow-none" placeholder="Tìm kiếm đơn hàng, sản phẩm...">
          </div>
        </div>

        <div class="d-flex align-items-center gap-3">
           <button class="btn btn-light rounded-circle position-relative">
              <i class="bi bi-bell"></i>
              <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle"></span>
           </button>
           <div class="vr mx-2"></div>
           <span class="fw-bold small text-secondary d-none d-sm-block">{{ status === 'ACTIVE' ? 'Hoạt động' : status === 'PENDING' ? 'Đang chờ xét duyệt' : status === 'REJECTED' ? 'Bị từ chối' : status === 'BANNED' ? 'Bị khóa' : 'Không xác định' }}</span>
        </div>
      </header>

      <div class="flex-grow-1 overflow-y-auto p-4 bg-light">
         <router-outlet></router-outlet>
      </div>

    </main>
  </ng-container>


  <div *ngIf="status === 'PENDING'" class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="col-md-6">
       <div class="card border-0 shadow-sm rounded-4 p-5 text-center bg-white">
          <div class="mb-4 text-warning">
             <div class="bg-warning bg-opacity-10 rounded-circle d-inline-flex p-4">
                <i class="bi bi-hourglass-split display-4 text-warning"></i>
             </div>
          </div>
          <h2 class="fw-bold mb-3">Đang chờ xét duyệt</h2>
          <p class="text-muted mb-4">
            Hồ sơ Shop <strong>{{ shop?.shopName }}</strong> đang được đội ngũ Admin kiểm tra.<br>
            Vui lòng quay lại sau 24h.
          </p>
          <button class="btn btn-outline-primary rounded-pill px-4" (click)="logout()">Đăng xuất</button>
       </div>
    </div>
  </div>


  <div *ngIf="status === 'REJECTED'" class="container py-5 d-flex justify-content-center align-items-center min-vh-100">
    <div class="col-md-6 col-lg-5">
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
        
        <div *ngIf="!isEditing" class="p-5 text-center bg-white">
           <div class="mb-4">
              <div class="bg-danger bg-opacity-10 rounded-circle d-inline-flex p-4">
                 <i class="bi bi-x-lg display-4 text-danger"></i>
              </div>
           </div>
           <h3 class="fw-bold text-danger mb-2">Yêu cầu bị từ chối</h3>
           <p class="text-muted mb-4">Thông tin đăng ký chưa đạt yêu cầu.</p>
           <div class="d-grid gap-2">
             <button class="btn btn-primary rounded-pill py-2 fw-bold" (click)="startEdit()">Cập nhật lại hồ sơ</button>
             <button class="btn btn-light rounded-pill py-2" (click)="logout()">Đăng xuất</button>
           </div>
        </div>

        <div *ngIf="isEditing" class="p-4 bg-white">
          <div class="d-flex justify-content-between align-items-center mb-4">
             <h5 class="fw-bold mb-0">Cập nhật hồ sơ</h5>
             <button class="btn-close" (click)="isEditing = false"></button>
          </div>
          
          <form [formGroup]="resubmitForm" (ngSubmit)="onResubmit()">
            <div class="mb-3">
              <label class="form-label small fw-bold text-muted">Tên Shop</label>
              <input type="text" class="form-control bg-light border-0" formControlName="shopName">
            </div>
            <div class="mb-3">
              <label class="form-label small fw-bold text-muted">Địa chỉ</label>
              <input type="text" class="form-control bg-light border-0" formControlName="address">
            </div>
            <div class="mb-3">
               <label class="form-label small fw-bold text-muted">Logo URL</label>
               <input type="text" class="form-control bg-light border-0" formControlName="logoUrl">
            </div>
            <div class="mb-4">
              <label class="form-label small fw-bold text-muted">Mô tả</label>
              <textarea class="form-control bg-light border-0" rows="3" formControlName="description"></textarea>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary rounded-pill py-2 fw-bold">Gửi lại yêu cầu</button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>

  </div>