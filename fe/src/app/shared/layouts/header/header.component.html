<div class="bg-white py-3 shadow-sm sticky-top">
  <div class="container">
    <div class="row align-items-center">

      <div class="col-md-2 d-flex align-items-center">
        <a routerLink="/" class="text-decoration-none d-flex align-items-center gap-2">
          
          <img src="logo.png" 
                
               style="width: 40px; height: 40px; object-fit: contain;">

          <span class="fw-bold fs-4 text-dark font-primary">E-Market</span>

        </a>
      </div>
      <div class="col-md-6 my-2 my-md-0">
        <div class="input-group">
          <button class="btn btn-outline-secondary dropdown-toggle bg-light border-end-0" type="button"
            data-bs-toggle="dropdown" style="min-width: 150px;">
            {{ selectedCategoryName }}
          </button>

          <ul class="dropdown-menu">
            <li>
              <a class="dropdown-item cursor-pointer fw-bold" (click)="onSelectCategory(null, 'Tất cả danh mục')">
                <i class="bi bi-grid-fill me-2"></i> Tất cả danh mục
              </a>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li *ngFor="let cat of categories">
              <ng-container *ngIf="cat.children && cat.children.length > 0">
                <a class="dropdown-item cursor-pointer has-children d-flex justify-content-between align-items-center"
                  (click)="onSelectCategory(cat.id, cat.name)">
                  {{ cat.name }}
                </a>

                <ul class="submenu shadow">
                  <li *ngFor="let child of cat.children">
                    <a class="dropdown-item cursor-pointer"
                      (click)="onSelectCategory(child.id, child.name); $event.stopPropagation()">
                      {{ child.name }}
                    </a>
                  </li>
                </ul>
              </ng-container>

              <ng-container *ngIf="!cat.children || cat.children.length === 0">
                <a class="dropdown-item cursor-pointer" (click)="onSelectCategory(cat.id, cat.name)">
                  {{ cat.name }}
                </a>
              </ng-container>

            </li>
          </ul>

          <input type="text" #searchInput (keyup.enter)="onSearch(searchInput.value)"
            class="form-control border-start-0 border-end-0" placeholder="Tìm kiếm sản phẩm...">

          <button class="btn btn-primary px-4" (click)="onSearch(searchInput.value)">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </div>

      <div class="col-md-4 d-flex justify-content-end align-items-center gap-3">
        <button class="btn btn-outline-primary rounded-pill px-3" (click)="handleSellerClick()">
          <i class="bi bi-shop-window me-1"></i>
          {{ currentUser?.isShopOwner ? 'Kênh Người Bán' : 'Đăng Ký Bán Hàng' }}
        </button>

        <div class="position-relative cursor-pointer text-secondary" routerLink="/cart"> <i
            class="bi bi-cart3 fs-4"></i>
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
            style="font-size: 10px;" *ngIf="cartService.totalCount() > 0">
            {{ cartService.totalCount() }}
          </span>
        </div>

        <div class="d-flex align-items-center gap-2 border-start ps-3 ms-2">
          @if (authService.isLoggedIn()) {
          <a routerLink="/profile" class="d-flex align-items-center text-decoration-none text-dark gap-2">

            <div class="bg-light rounded-circle d-flex justify-content-center align-items-center overflow-hidden"
              style="width: 35px; height: 35px;">
              <img *ngIf="currentUser?.avatarUrl; else defaultIcon" [src]="currentUser?.avatarUrl" alt="Avatar"
                style="width: 100%; height: 100%; object-fit: cover;">

              <ng-template #defaultIcon>
                <i class="bi bi-person fs-5 text-primary"></i>
              </ng-template>
            </div>

            <div class="d-none d-xl-block lh-1 text-start">
              <div class="small text-muted" style="font-size: 11px;">
                {{ currentUser?.role === 'SELLER' ? 'Seller Account' : 'Member' }}
              </div>
              <div class="fw-bold text-truncate" style="font-size: 13px; max-width: 100px;">
                {{ currentUser?.fullName || currentUser?.username || 'User' }}
              </div>
            </div>
          </a>

          <button class="btn btn-sm btn-link text-danger text-decoration-none" (click)="authService.logout()">
            <i class="bi bi-box-arrow-right"></i>
          </button>

          } @else {
          <a routerLink="/login" class="btn btn-sm btn-primary">  Đăng nhập</a>
          }
        </div>
      </div>
    </div>
  </div>
</div>